# 声明式事务讲解-27

需要四个advice  总共五个对象

AspectJAwareAdvisorAutoProxyCreator

advisor ------------》DefaultBeanFactoryPointcutAdvisor

methodIntercepter ----》 TransactionInterceptor----NameMatchTransactionAttributeSource设置关于事务的属性

 pointcut ----》AspectJExpressionPointcut-----实例化

从xml---------注解

loadBeanDefinition加载配置文件-----对象的属性--------对象之间的包含关系

advisor-----advice-----1.method 2. 表达式 3.

##### obtainFreshBeanFactory-----》

loadBeanDefinitions(beanFactory)------》AbstractXmlApplicationContext中的loadBeanDefinitions方法中进入-----》XmlBeanDefinitionReader的loadBeanDefinitions方法------最终进入doLoadBeanDefinitions(inputSource, encodedResource.getResource())方法逻辑处理的核心步骤

------------------------------》进入DefaultBeanDefinitionDocumentReader类的parseBeanDefinitions类对xml标签一行一行进行解析，

在configbeanndefinitionParser的parse方法中1.configureAutoProxyCreator(parserContext, element)方法会自动注册代理模式创建器，AspectJAwareAdvisorAutoProxyCreator 2.分别对POINTCUT ADVISOR  ASPECT的元素进行解析

在AbstractBeanDefinitionParser的parse方法中 解析tx标签以及子标签，tx:advice tx:attributes tx:method

```
调用子类重写的doParse方法进行解析
doParse(element, parserContext, builder);
```

##### invokeBeanFactoryPostProcessors(beanFactory)完成属性替换

##### registerBeanPostProcessors(beanFactory)创建AspectJAwareAdvisorAutoProxyCreator对象

##### finishBeanFactoryInitialization 创建上面的四个对象具体过程

1创建DefaultBeanFactoryPointcutAdvisor过程中，在注入属性的时候会对advice和pointcut（AspectJExpressionPointcut）进入创建并注入，BeanFactory是通过BeanFactoryAware来注入的

2.创建TransactionInterceptor和NameMatchTransactionAttributeSource

```
DefaultListableBeanFactory  1006
```

#### 回归一波创建对象的五种方式

1.自定义BeanPostProcessor生成代理对象InstantiationAwareBeanPostProcessor

2.通过反射创建对象

3.通过factoryMethod创建对象

4.通过FactoryBean创建对象

5.通过supplier创建对象

